var appConfig={title:"Kevin App Framework",resourceList:[],apiList:{},loadWechatJSSDKConfigUrl:"",envList:[{id:"dev",domain:"localhost",apiDomain:"localhost",apiBaseUrl:"/"},{id:"beta",domain:"test.xx.com",apiDomain:"test.xx.com",apiBaseUrl:"test.xx.com/api/"},{id:"dist",domain:"www.xx.com",apiDomain:"api.xx.com",apiBaseUrl:"api.xx.com/api/"}],apiDomain:"",apiBaseUrl:"/",subPageContainner:"#main_content_container",sound:{message:"media/message.mp3",delete:"media/delete.mp3",logon:"media/logon.mp3",navigation:"media/navigation.mp3"},ajaxErrorHandle:function(e,t){var a=e.status,o=e.statusText,i=e.responseText,n="";if("function"==typeof getDebugStatus&&getDebugStatus()){if(n="Status code: "+a+" "+o,app.showMessageBox(n,"出错了"),$("#debugInfoDialog").length){var s="<p>"+n+"</p>";$("#debugInfoDialog .infoContainer").append(s);s="<p>"+i+"</p>";$("#debugInfoDialog .infoContainer").append(s)}}else n=500<=a&&a<600?errorMessageList.InternalServerError:408===a?errorMessageList.RequestTimeout:409===a?errorMessageList.RequestConflict:errorMessageList.defaultText,app.showMessageBox(n,"失败")},ajaxErrorLogHandle:function(e,t){var a=e.status,o=e.statusText;e.responseText;addConsoleLog("Status code: "+a+" "+o,"出错了")},fancyboxOptions:{iframe:{css:{width:"90%",height:"90%"}}},lightboxOption:{alwaysShowNavOnTouchDevices:!0,albumLabel:"%1/%2"}};"undefined"!=typeof apiList&&(appConfig.apiList=apiList);var application={title:"",env:"dev",baseUrl:"/",apiBaseUrl:"/",status:"",resourceList:[],config:{},subPageUrl:"",subPageContainner:"",current:"",panelParams:{},subPageParams:{},apiList:{},soundPlayer:document.createElement("audio"),user:null,init:function(e){if("ready"==this.status)return!0;this.title=appConfig.title||"",this.config=appConfig||{},this.apiList=this.config.apiList||{},this.checkEnvironment(this.config.envList||[]),this.initResources(this.config.resourceList||[]),this.soundPlayer.volume=1,this.soundPlayer.autoplay=!1,this.soundPlayer.defaultMuted=!1,this.soundPlayer.error=function(e){addConsoleLog("sound player has a error:"),addConsoleLog(e)},this.status="ready"},checkEnvironment:function(e){for(var t=location.hostname,a=0;a<e.length;a++)if(e[a].domain==t)return this.env=e[a].id,this.baseUrl=e[a].baseUrl,this.apiDomain=e[a].apiDomain,void(this.apiBaseUrl=e[a].apiBaseUrl)},initResources:function(e){this.resourceList=[];for(var t=document.getElementsByTagName("link"),a=0;a<t.length;a++)this.resourceList.push(t[a].href);var o=document.getElementsByTagName("script");for(a=0;a<o.length;a++)this.resourceList.push(o[a].src);for(a=0;a<e.length;a++)this.import(e[a])},import:function(e){for(var t=getUrlFileName(e),a=0;a<this.resourceList.length;a++){if(t===getUrlFileName(this.resourceList[a]))return}isCSSFile(e)?this.resourceList.push(loadStylesheet(e)):isScriptFile(e)&&this.resourceList.push(loadScript(e))},showHint:function(e,t){void 0===t&&(t={});var a=t.delay||2,o=createElement("div",{class:"hintBox"},e);document.body.appendChild(o);var i=o.offsetWidth,n=o.offsetHeight;o.style.marginLeft="-"+i/2+"px",o.style.marginTop="-"+n/2+"px",o.style.opacity=1,window.setTimeout(function(){o.parentNode.removeChild(o)},1e3*a)},showMessageBox:function(e,t,a){"undefined"!=typeof dialog?dialog.msg(e):alert(e)},loadCityData:function(a){$.ajax({url:"../../data/cities.json",dataType:"json",success:function(e){a&&a(e,null)},error:function(e,t){a&&a(null,{XMLHttpRequest:e,errorText:t})}})},loadWechatJSSDKConfig:function(e){var t=e.jsApiList||[],a=e.onReady||null,o=e.onError||null,i=this.getApi("load_wechat_jssdk_config");if(i){$.ajax({type:"get",url:this.apiBaseUrl+i.url,dataType:"json",data:{url:location.href},success:function(e){wx.config({debug:getDebugStatus(),appId:e.data.appId,timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,signature:e.data.signature,jsApiList:t}),wx.ready(a),o&&wx.error(o)}})}},getApi:function(e,t){return e in apiList?apiList[e]:t||null},callApi:function(e,t){var a=this.getApi(e);if(!a)return alertDebugLog("api name: "+e+" not find."),!1;!t&&(t={}),t.dataType=t.dataType||"json",t.type=a.type||a.method||t.type||"get",t.error=t.error||this.ajaxErrorHandle,$.ajax(a.url,t)},openPanel:function(e,t){this.current!==e&&(this.current=e,this.panelParams=t||{},$("#main_content_container").html(""),$.ajax({url:e,success:function(e){$("#main_content_container").html(e)}}))},openPanelAsIframe:function(e,t){var a=createUrl(e,t);if(this.current!==a){this.current=a,this.panelParams=t||{},$("#main_content_container").html('<iframe src="'+a+'" style="width:100%;border:none;"></iframe>');var o=screen.height/screen.width,i=$("#main_content_container iframe").width(),n=Math.floor(i*o);$("#main_content_container iframe").css({height:n+"px"})}},loadSubPage:function(e,t){var a=this;this.subPageUrl!==e&&(this.subPageUrl=e,this.subPageParams=t||{},$(this.subPageContainner).html(""),$.ajax({url:e,success:function(e){$(a.subPageContainner).html(e)}}))},loadSubPageAsIframe:function(e,t){var a=createUrl(e,t);if(this.subPageUrl!==a){this.subPageUrl=a,this.subPageParams=t||{},$(this.subPageContainner).length&&"iframe"===$(this.subPageContainner)[0].nodeName?$(this.subPageContainner)[0].src=a:$(this.subPageContainner).html('<iframe src="'+a+'" style="width:100%;border:none;"></iframe>');var o=screen.height/screen.width,i=$(this.subPageContainner).find("iframe").width(),n=Math.floor(i*o);$(this.subPageContainner).find("iframe").css({height:n+"px"})}},logout:function(){var e=this.getApi("logout");$.ajax({url:e.url,complete:function(){location.href="login.html"}})},setWechatShare:function(e){return"undefined"==typeof wx?(addConsoleLog("[error] wx object not defined."),!1):(void 0!==wx.updateTimelineShareData?(e=mergeObject(e,{success:function(){log("set wechat share success.")},fail:function(){log("set wechat share failed.")}}),wx.updateTimelineShareData(e),wx.updateAppMessageShareData(e)):(e=mergeObject(e,{success:function(){log("wechat share success callback.")},fail:function(){log("wechat share fail callback.")},cancel:function(){log("wechat share cancel callback")}}),wx.onMenuShareTimeline(e),wx.onMenuShareAppMessage(e),wx.onMenuShareQQ(e),wx.onMenuShareQZone(e),wx.onMenuShareWeibo(e)),!0)},playSound:function(e){if(void 0===this.config.sound[e])return addConsoleLog("[error] not found sound file with type: "+e),!1;var t=this.baseUrl+this.config.sound[e];this.soundPlayer.paused||this.soundPlayer.pause(),this.soundPlayer.src=t,log("play sound, type: "+e+".");try{this.soundPlayer.play()}catch(e){return log("play sound failed."),addConsoleLog(e),!1}return log("play sound success."),!0},checkPromotion:function(){if((e=getUrlParam("promotionCode")||"")&&(log("url have promotionCode: "+e),setSessionData("promotionCode",e)||$.cookie("promotionCode",e,{path:"/"})),this.user){log("logined, check promotionCode:");var e=getSessionData("promotionCode")||$.cookie("promotionCode");log("promotionCode= "+e),e&&this.user.introduceCode!=e&&(log("promotionCode is not mine, save promotion_from="+promotion_from+"."),setCacheData("promotion_from",e)),log("remove old promotionCode"),removeSessionData("promotionCode")||$.removeCookie("promotionCode")}}},app=application;